
<div style="margin-top: 15px; margin-left: 10px; margin-right: 10px">
    <div style="display: flex;flex-wrap:wrap">
        <div style="text-align:left;flex:1;min-width:150px">
            <button class="layui-btn" type="button" id="preWeek">Pre</button>
            <button class="layui-btn" type="button" id="nextWeek">Next</button>
        </div>
        <div style="text-align:center;flex:1;min-width:150px"><span style=" line-height: 38px;font-weight:700">当前学员:@ViewBag.studentName</span></div>
        <div style="text-align:right">
            <div class="layui-form">
                <div class="layui-form-item" style="text-align:left">
                    <div class="layui-inline">
                        <label class="layui-form-label w-auto">分类:</label>
                        <div class="layui-input-inline mr0">
                            <select name="SubjectId" class="layui-select" lay-filter="SubjectId" id="SubjectId"></select>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label w-auto">科目:</label>
                        <div class="layui-input-inline mr0">
                            <select name="ProjectId" class="layui-select" lay-filter="ProjectId" id="ProjectId"></select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div style="flex:1;text-align:right;">
            <div style="display: flex;">
                <label class="layui-form-label">导出时间段</label>
                <input name="StartTime" id="StartTime" placeholder="开始时间" class="layui-input" style="width:100px" />&nbsp;<span style="width: 2px;
                padding-top: 5px;margin-right: 5px;color: yellowgreen">_</span> &nbsp;
                <input name="EndTime" id="EndTime" placeholder="截止时间" class="layui-input" style="width:100px" />
                <button class="layui-btn" type="button" onclick="exportPlan()" style="margin-left:5px">导出(Excel)</button>
                <button class="layui-btn" type="button" onclick="pdfPlan()">导出(PDF)</button>
            </div>
        </div>
    </div>
    <table class="layui-table" >
        <tbody id="plantbody" style="word-break:break-all">
        </tbody>
    </table>
    <input type="hidden" name="StudentUid" value="@ViewBag.studentUid" />
</div>
@section css{
    <link rel="stylesheet" href="/assets/module/formSelects/formSelects-v4.css" />
    <style>
        .layui-table-cell {
            height: auto;
            line-height: 28px;
        }

        .layui-table img {
            max-width: 600px;
        }
        .planPart {
            border-color: rgb(224, 224, 224);
            background-color: yellowgreen;
            box-shadow: 0px 0px 0px 1px #fff;
            color: white;
            font-size:12px;
        }
        .planPartBlue {
            border-color: rgb(224, 224, 224);
            background-color: cadetblue;
            box-shadow: 0px 0px 0px 1px #fff;
            color: white;
            font-size: 12px;
        }
        .planPartMoack{
            border-color: rgb(224, 224, 224);
            background-color:#c6b62e;
            box-shadow: 0px 0px 0px 1px #fff;
            color: white;
            font-size: 12px;
        }
        .planPartshik {
            border-color: rgb(224, 224, 224);
            background-color:#a24d65;
            box-shadow: 0px 0px 0px 1px #fff;
            color: white;
            font-size: 12px;
        }
        .planShiting {
            border-color: rgb(224, 224, 224);
            background-color: #60605a;
            box-shadow: 0px 0px 0px 1px #fff;
            color: white;
            font-size: 12px;
        }
        .planPartBanke {
            border-color: rgb(224, 224, 224);
            background-color: #009688;
            box-shadow: 0px 0px 0px 1px #fff;
            color: white;
            font-size: 12px;
        }
        .planGuiHua {
            border-color: rgb(224, 224, 224);
            background-color: #03a9f4;
            box-shadow: 0px 0px 0px 1px #fff;
            color: white;
            font-size: 12px;
        }
        .planRelex {
            border-color: rgb(33, 150, 243);
            background-color: #03a9f4;
            box-shadow: 0px 0px 0px 1px #fff;
            color: white;
            font-size: 12px;
        }
    </style>
}
@section js{
    <!-- js部分 -->
    <script>
        layui.use(['form', 'admin', 'adminForm', 'laydate'], function () {
            var form = layui.form;
            var admin = layui.admin;
            var adminForm = layui.adminForm;
            var laydate = layui.laydate;
            //日期
            laydate.render({
                elem: '#StartTime'
                , type: 'date',
                format: 'yyyy-MM-dd'
            });
            laydate.render({
                elem: '#EndTime'
                , type: 'date',
                format: 'yyyy-MM-dd'
            });
            adminForm.load({
            url: "@Url.Action("QuerySubject","ContracUser")",
            dataType: 'json',
            callBack: function (rou) {
                    if (rou.data != null) {
                        var result = rou.data;
                        $("select[name='SubjectId']").html("<option value='0'>-分类-</option>");
                        $("select[name='ProjectId']").html("<option value='0'>-科目-</option>");
                        for (var i = 0; i < result.length; i++) {
                            $("select[name='SubjectId']").append('<option value = ' + result[i].SubjectId + '>' + result[i].SubjectName + '</option>');
                        }
                    }
                }
            });
            form.on('select(SubjectId)', function (data) {
                var sujectId=data.value;
                adminForm.load({
                url: "@Url.Action("QueryProject", "ContracUser")?subjectId=" + sujectId,
                dataType: 'json',
                    callBack: function (rou) {
                     $("select[name='ProjectId']").html("<option value='0'>-科目-</option>");
                        if (rou.data != null) {
                            var result = rou.data;
                            for (var i = 0; i < result.length; i++) {
                                $("select[name='ProjectId']").append('<option value = ' + result[i].ProjectId + '>' + result[i].ProjectName + '</option>');
                            }
                        }
                    }
                });
            });
            form.on('select(ProjectId)', function (data) {
                plan.isAdd = 0;
                planSearch(plan);
            });
        });

        var plan = {
            isAdd: 0,
            starttime:null,
            endtime:null
        }
        $("#preWeek").click(function () {
            plan.isAdd = 1;
            planSearch(plan);
        })
        $("#nextWeek").click(function () {
            plan.isAdd =2;
            planSearch(plan);
        })
        function planSearch(plan) {
            layui.use(['form','admin', 'adminForm'], function () {
                     var admin = layui.admin;
                     var adminForm = layui.adminForm;
                    $("#plantbody").html("");
                    var subjectId = $("select[name='SubjectId']").val();
                    var projectId = $("select[name='ProjectId']").val();
                     adminForm.load({
                        url: "@Url.Action("QueryStudentPlan")",
                         data: { studentUid: $("input[name='StudentUid']").val(), isAdd: plan.isAdd, subjectId: subjectId,projectId:projectId,starttime: plan.starttime, endtime: plan.endtime },
                        dataType: 'json',
                        callBack: function (rou) {
                            if (rou != null) {
                                var result = rou;
                                var trAppend = "";
                                for (var i = 0; i < 20; i++) {
                                    if (i == 0) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;min-width:76px'>日期</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            if (j == 0) {
                                                plan.starttime = dateFtt("yyyy-MM-dd", result[j].WorkDate.replace(/-/g, '/'));
                                            }
                                            if (j == result.length-1) {
                                                plan.endtime = dateFtt("yyyy-MM-dd", result[j].WorkDate.replace(/-/g, '/'));
                                            }
                                            trAppend += "<td style='text-align:center;min-width:160px;'> " + dateFtt("yyyy-MM-dd", result[j].WorkDate.replace(/-/g, '/')) + " </td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 1) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px'>星期</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            trAppend += "<td style='text-align:center;'>" + result[j].WorkDateName + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 2) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>8:00-10:00</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Eight_Ten_Id,
                                                workTtile: result[j].Eight_Ten_OlockTitle,
                                                workDate: result[j].WorkDate,
                                                startTime: '8:00',
                                                endTime:'10:00'
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            var isReversion = result[j].Eight_Ten_Reversion;
                                            var studymodel = result[j].Eight_Ten_StudyMode;
                                            var classColor = "planPartBlue";
                                            if (planVmodel.Id > 0 && isReversion == false) {
                                                classColor = "planPartBlue";
                                            }
                                            else {
                                                classColor = "planPart"
                                                if (studymodel ==2) {
                                                    classColor = "planPartBanke"
                                                }
                                                else if (studymodel == 4) {
                                                    classColor = "planShiting"
                                                }
                                                else if (studymodel == 5) {
                                                    classColor = "planPartMoack"
                                                }
                                                else if (studymodel == 6) {
                                                    classColor = "planPartshik"
                                                }
                                                else if (studymodel == 8) {
                                                    classColor = "planGuiHua"
                                                }
                                                else if (studymodel == 9) {
                                                    classColor = "planRelex"
                                                }
                                            }
                                            trAppend += "<td onclick='planShow(" + jsonVmodel + ")'><div class='" + classColor + "'>" + (result[j].Eight_Ten_OlockTitle != null ? result[j].Eight_Ten_OlockTitle : "") + "</div></td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 3) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px'>10:00-12:00</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Ten_Twelve_Id,
                                                workTtile: result[j].Ten_Twelve_OlockTitle,
                                                workDate: result[j].WorkDate,
                                                startTime: '10:00',
                                                endTime: '12:00'
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            var isReversion = result[j].Ten_Twelve_Reversion;
                                            var studymodel = result[j].Ten_Twelve_StudyMode;
                                            var classColor = "planPartBlue";
                                            if (planVmodel.Id > 0 && isReversion == false) {
                                                classColor = "planPartBlue";
                                            }
                                            else {
                                                classColor = "planPart"
                                                if (studymodel == 2) {
                                                    classColor = "planPartBanke"
                                                }
                                                else if (studymodel == 4) {
                                                    classColor = "planShiting"
                                                }
                                                else if (studymodel == 5) {
                                                    classColor = "planPartMoack"
                                                }
                                                else if (studymodel == 6) {
                                                    classColor = "planPartshik"
                                                }
                                                else if (studymodel == 8) {
                                                    classColor = "planGuiHua"
                                                }
                                                else if (studymodel == 9) {
                                                    classColor = "planRelex"
                                                }
                                            }
                                            trAppend += "<td onclick='planShow(" + jsonVmodel + ")'><div class='" + classColor + "'>" + (result[j].Ten_Twelve_OlockTitle == null ? "" : result[j].Ten_Twelve_OlockTitle) + "</div></td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 4) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>13:00-15:00</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Thirteen_Fifteen_Id,
                                                workTtile: result[j].Thirteen_Fifteen_OlockTitle,
                                                workDate: result[j].WorkDate,
                                                startTime: '13:00',
                                                endTime: '15:00'
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            var isReversion = result[j].Thirteen_Fifteen_Reversion;
                                            var studymodel = result[j].Thirteen_Fifteen_StudyMode;
                                            var classColor = "planPartBlue";
                                            if (planVmodel.Id > 0 && isReversion == false) {
                                                classColor = "planPartBlue";
                                            }
                                            else {
                                                classColor = "planPart"
                                                if (studymodel == 2) {
                                                    classColor = "planPartBanke"
                                                }
                                                else if (studymodel == 4) {
                                                    classColor = "planShiting"
                                                }
                                                else if (studymodel == 5) {
                                                    classColor = "planPartMoack"
                                                }
                                                else if (studymodel == 6) {
                                                    classColor = "planPartshik"
                                                }
                                                else if (studymodel == 8) {
                                                    classColor = "planGuiHua"
                                                }
                                                else if (studymodel == 9) {
                                                    classColor = "planRelex"
                                                }
                                            }
                                            trAppend += "<td onclick='planShow(" + jsonVmodel + ")'><div class='" + classColor + "'>" + (result[j].Thirteen_Fifteen_OlockTitle == null ? "" : result[j].Thirteen_Fifteen_OlockTitle) + "</div></td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 5) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>15:00-17:00</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Fifteen_Seventeen_Id,
                                                workTtile: result[j].Fifteen_Seventeen_OlockTitle,
                                                workDate: result[j].WorkDate,
                                                startTime: '15:00',
                                                endTime: '17:00'
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            var isReversion = result[j].Fifteen_Seventeen_Reversion;
                                            var studymodel = result[j].Fifteen_Seventeen_StudyMode;
                                            var classColor = "planPartBlue";
                                            if (planVmodel.Id > 0 && isReversion == false) {
                                                classColor = "planPartBlue";
                                            }
                                            else {
                                                classColor = "planPart"
                                                if (studymodel ==2) {
                                                    classColor = "planPartBanke"
                                                }
                                                else if (studymodel == 4) {
                                                    classColor = "planShiting"
                                                }
                                                else if (studymodel == 5) {
                                                    classColor = "planPartMoack"
                                                }
                                                else if (studymodel == 6) {
                                                    classColor = "planPartshik"
                                                }
                                                else if (studymodel == 8) {
                                                    classColor = "planGuiHua"
                                                }
                                                else if (studymodel == 9) {
                                                    classColor = "planRelex"
                                                }
                                            }
                                            trAppend += "<td onclick='planShow(" + jsonVmodel + ")'><div class='" + classColor + "'>" + (result[j].Fifteen_Seventeen_OlockTitle == null ? "" : result[j].Fifteen_Seventeen_OlockTitle) + "</div></td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 6) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>17:00-19:00</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Seventeen_Nineteen_Id,
                                                workTtile: result[j].Seventeen_Nineteen_OlockTitle,
                                                workDate: result[j].WorkDate,
                                                startTime: '17:00',
                                                endTime: '19:00'
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            var isReversion = result[j].Seventeen_Nineteen_Reversion;
                                            var studymodel = result[j].Seventeen_Nineteen_StudyMode;
                                            var classColor = "planPartBlue";
                                            if (planVmodel.Id > 0 && isReversion == false) {
                                                classColor = "planPartBlue";
                                            }
                                            else {
                                                classColor = "planPart"
                                                if (studymodel == 2) {
                                                    classColor = "planPartBanke"
                                                }
                                                else if (studymodel == 4) {
                                                    classColor = "planShiting"
                                                }
                                                else if (studymodel == 5) {
                                                    classColor = "planPartMoack"
                                                }
                                                else if (studymodel == 6) {
                                                    classColor = "planPartshik"
                                                }
                                                else if (studymodel == 8) {
                                                    classColor = "planGuiHua"
                                                }
                                                else if (studymodel == 9) {
                                                    classColor = "planRelex"
                                                }
                                            }
                                            trAppend += "<td onclick='planShow(" + jsonVmodel + ")'><div class=" + classColor + ">" + (result[j].Seventeen_Nineteen_OlockTitle == null ? "" : result[j].Seventeen_Nineteen_OlockTitle) + "</div></td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 7) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>19:00-21:00</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Nineteen_TwentyOne_Id,
                                                workTtile: result[j].Nineteen_TwentyOne_OlockTitle,
                                                workDate: result[j].WorkDate,
                                                startTime: '19:00',
                                                endTime: '21:00'
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            var isReversion = result[j].Nineteen_TwentyOne_Reversion;
                                            var studymodel = result[j].Nineteen_TwentyOne_StudyMode;
                                            var classColor = "planPartBlue";
                                            if (planVmodel.Id > 0 && isReversion == false) {
                                                classColor = "planPartBlue";
                                            }
                                            else {
                                                classColor = "planPart"
                                                if (studymodel == 2) {
                                                    classColor = "planPartBanke"
                                                }
                                                else if (studymodel == 4) {
                                                    classColor = "planShiting"
                                                }
                                                else if (studymodel == 5) {
                                                    classColor = "planPartMoack"
                                                }
                                                else if (studymodel == 6) {
                                                    classColor = "planPartshik"
                                                }
                                                else if (studymodel == 8) {
                                                    classColor = "planGuiHua"
                                                }
                                                else if (studymodel == 9) {
                                                    classColor = "planRelex"
                                                }
                                            }
                                            trAppend += "<td onclick='planShow(" + jsonVmodel + ")'><div class=" + classColor + ">" + (result[j].Nineteen_TwentyOne_OlockTitle == null ? "" : result[j].Nineteen_TwentyOne_OlockTitle) + "</div></td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 8) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>21:00-23:00</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].TwentyOne_TwentyTree_Id,
                                                workTtile: result[j].TwentyOne_TwentyTree_OlockTitle,
                                                workDate: result[j].WorkDate,
                                                startTime: '21:00',
                                                endTime: '23:00'
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            var isReversion = result[j].TwentyOne_TwentyTree_Reversion;
                                            var studymodel = result[j].TwentyOne_TwentyTree_StudyMode;
                                            var classColor = "planPartBlue";
                                            if (planVmodel.Id > 0 && isReversion == false) {
                                                classColor = "planPartBlue";
                                            }
                                            else {
                                                classColor = "planPart"
                                                if (studymodel == 2) {
                                                    classColor = "planPartBanke"
                                                }
                                                else if (studymodel == 4) {
                                                    classColor = "planShiting"
                                                }
                                                else if (studymodel == 5) {
                                                    classColor = "planPartMoack"
                                                }
                                                else if (studymodel == 6) {
                                                    classColor = "planPartshik"
                                                }
                                                else if (studymodel == 8) {
                                                    classColor = "planGuiHua"
                                                }
                                                else if (studymodel == 9) {
                                                    classColor = "planRelex"
                                                }
                                            }
                                            trAppend += "<td onclick='planShow(" + jsonVmodel + ")'><div class=" + classColor + ">" + (result[j].TwentyOne_TwentyTree_OlockTitle == null ? "" : result[j].TwentyOne_TwentyTree_OlockTitle) + "</div></td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 9) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;vertical-align:top'>单词</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile: result[j].ChouciComent,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")' style='vertical-align:top'>" + (result[j].ChouciComent == null ? "" : result[j].ChouciComent) + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 10) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;vertical-align:top'>课程点评</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile: result[j].CourseComent,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")' style='vertical-align:top'>" + (result[j].CourseComent == null ? "" : result[j].CourseComent) + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 11) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;vertical-align:top'>布置作业</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            trAppend += "<td style='vertical-align:top'>" + (result[j].CourseWorkCotent == null ? "" : result[j].CourseWorkCotent) + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 12) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;vertical-align:top'>已完成作业</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile: result[j].HomeWorkComent,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")' style='vertical-align:top'>" + (result[j].HomeWorkComent == null ? "" : result[j].HomeWorkComent) + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 13) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>待完成作业</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile: result[j].OtherComent,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")'>" + (result[j].OtherComent == null ? "" : result[j].OtherComent) + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 14) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>责任助教</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile:null,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")'>" + (result[j].TaUseName == null ? "" : result[j].TaUseName) + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 15) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>每日总结</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile: result[j].SummaryComent,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")'>" + (result[j].SummaryComent == null ? "" : result[j].SummaryComent) + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 16) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>到校时间</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile: result[j].InSchoolTime,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")'>" + (result[j].InSchoolTime == null ? "" : result[j].InSchoolTime) + "</td>";
                                        }
                                        trAppend += "</tr>";
                                    }
                                    else if (i == 17) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>离校时间</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile: result[j].OutSchoolTime,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")'>" + (result[j].OutSchoolTime == null ? "" : result[j].OutSchoolTime) + "</td>";
                                        }
                                        trAppend += "</tr>";

                                    }
                                    else if (i == 18) {
                                        trAppend += "<tr>";
                                        trAppend += "<td style='width:120px;'>在校时长</td>";
                                        for (var j = 0; j < result.length; j++) {
                                            var planVmodel = {
                                                Id: result[j].Id,
                                                workTtile: result[j].TotalTime,
                                                workDate: result[j].WorkDate
                                            }
                                            var jsonVmodel = JSON.stringify(planVmodel);
                                            trAppend += "<td onclick='planShow2(" + jsonVmodel + ")'>" + (result[j].TotalTime == null ? "" : result[j].TotalTime) + "</td>";
                                        }
                                        trAppend += "</tr>";

                                    }
                                }
                                $("#plantbody").append(trAppend);
                            }
                            if (plan.starttime != undefined && plan.starttime != null) {
                                $("#StartTime").val(plan.starttime);
                            }
                            if (plan.endtime != undefined && plan.endtime != null) {
                                $("#EndTime").val(plan.endtime);
                            }
                        }
                    });
            });

        }
        planSearch(plan);
        function exportPlan() {
            var studentUid = $("input[name='StudentUid']").val();
            var subjectId = $("select[name='SubjectId']").val();
            var projectId = $("select[name='ProjectId']").val();
            window.location.href = '@Url.Action("ExportPlan")?studentUid=' + studentUid + '&isAdd=' + plan.isAdd + '&subjectId=' + subjectId + '&projectId='+projectId+ '&starttime=' + $("#StartTime").val() + '&endtime=' +$("#EndTime").val();
        }
        function pdfPlan() {
            var studentUid = $("input[name='StudentUid']").val();
            var subjectId = $("select[name='SubjectId']").val();
            var projectId = $("select[name='ProjectId']").val();
            window.open('@Url.Action("ExportPdf")?studentUid=' + studentUid + '&isAdd=' + plan.isAdd + '&subjectId=' + subjectId + '&projectId=' + projectId+ '&starttime=' + $("#StartTime").val() + '&endtime=' + $("#EndTime").val());
        }
      function planShow(vmodel) {
        var studentUid = $("input[name='StudentUid']").val();
        if (vmodel.Id==0 &&vmodel.workTtile !=null) {return false;}
         layui.use([ 'adminList'], function () {
            var adminList = layui.adminList;
                adminList.form({
                title: (vmodel.Id > 0 ? '修改' : '添加') + '任务计划',
                type: 2,
                width: "660px",
                height: "530px",
                    content: vmodel.Id > 0 ? '@Url.Action("Edit")?ID=' + vmodel.Id : '@Url.Action("Add")?studentUid=' + studentUid + '&dataStr=' + dateFtt("yyyy-MM-dd", vmodel.workDate.replace(/-/g, '/')) + '&startTime=' + vmodel.startTime + '&endTime=' + vmodel.endTime,
                end: function () {
                    plan.isAdd = 0;
                    planSearch(plan);
                }
            });
        });
    }
      function planShow2(vmodel) {
          var studentUid = $("input[name='StudentUid']").val();
          if (vmodel.Id == 0 && vmodel.workTtile != null && vmodel.workTtile !='') {return false;}
         layui.use([ 'adminList'], function () {
            var adminList = layui.adminList;
                adminList.form({
                title: (vmodel.Id > 0 ? '修改' : '添加') + '任务计划',
                type: 2,
                width: "660px",
                height: "530px",
                    content: vmodel.Id > 0 ? '@Url.Action("EditComment")?ID=' + vmodel.Id : '@Url.Action("AddComment")?studentUid=' + studentUid + '&dataStr=' + dateFtt("yyyy-MM-dd",vmodel.workDate.replace(/-/g, '/')),
                end: function () {
                    plan.isAdd = 0;
                    planSearch(plan);
                }
            });
        });
    }
      function dateFtt(fmt, val) { //author: meizz
        var date = new Date(val);
        var o = {
            "M+": date.getMonth() + 1,     //月份
            "d+": date.getDate(),     //日
            "h+": date.getHours(),     //小时
            "m+": date.getMinutes(),     //分
            "s+": date.getSeconds(),     //秒
            "q+": Math.floor((date.getMonth() + 3) / 3), //季度
            "S": date.getMilliseconds()    //毫秒
        };
        if (/(y+)/.test(fmt))
            fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt))
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }
    </script>
}